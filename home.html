<!DOCTYPE html>
<html>

<head>
  <style>
    .title {
      background-color: rgb(0, 222, 11);
      color: rgb(0, 0, 0);
      border: 2px solid black;
      margin: 20px;
      padding: 20px;
    }
  </style>
</head>


<script>
  function searchMovie() {
    titleElement = document.getElementById("title");
    title = titleElement.value;
    title = title.replace(" ", "+");
    fetch(`http://localhost:8080/movie/${title}`, {
      method: 'GET',
    })
      .then(flixedRes => flixedRes.json())
      .then((data) => {
        results = document.getElementById("resultsText");
        results.innerText = data.url;
        results.style.display = "block";
      })
      .catch((error) => {
        results = document.getElementById("resultsText");
        results.innerText = error.message;
        results.style.display = "block";
      });
  }

  function searchTvShow() {
    titleElement = document.getElementById("title");
    title = titleElement.value;
    title = title.replace(" ", "+");

    fetch(`http://www.omdbapi.com/?t=${title}&apikey=53dcb6b7`, {
      method: 'GET',
      headers: {
        accept: 'application/json',
      },
    })
      .then(response => response.json())
      .then((titleData) => {
        id = titleData.imdbID;
        while (id.charAt(0) === 't') {
          id = id.substring(1);
        }
        fetch(`http://localhost:8080/tvshow/${id}`, {
          method: 'GET',
        })
          .then(flixedRes => flixedRes.json())
          .then((data) => {
            results = document.getElementById("resultsText");
            results.innerText = data.url;
            results.style.display = "block";
          })
          .catch((error) => {
            results = document.getElementById("resultsText");
            results.innerText = error.message;
            results.style.display = "block";
          });
      })
      .catch((error) => {
        results = document.getElementById("resultsText");
        results.innerText = error.message;
        results.style.display = "block";
      });
  }

  function enterSearch(event) {
    if (event.keyCode === 13) {
      if (document.getElementById("tvOrMovie").value === "Movie") {
        searchMovie();
      } else {
        searchTvShow();
      }
    }
  }

  function toggle() {
    switchValue = document.getElementById("tvOrMovie").value;
    document.getElementById("searchButton").innerText = `Search ${switchValue}`;

    if (switchValue = "TV Show") {
      document.getElementById("searchButton").onclick = searchTvShow();
    } else {
      document.getElementById("searchButton").onclick = searchMovie();
    }
  }

  //testing code
  function apiAccessTest(event) {

  }

</script>

<body>

  <div id="Header" class="title">
    <h2>Streamlist</h2>
    <p>name is a work in progress and not very good, be nice</p>
  </div>

  <div>
    <input id="title" type="text" onkeypress="enterSearch(event)" placeholder="Search Name...">

    <button id="searchButton" type="button" onclick="searchMovie()">Search Movie</button>

    <select name="tvOrMovie" id="tvOrMovie" data-role="slider" onchange="toggle()">
      <option value="Movie">Movie</option>
      <option value="TV Show">TV Show</option>
    </select>

    <!--testing code-->
    <button id="apiTest" type="button" onclick="apiAccessTest()">Test API</button>
  </div>

  <p id="resultsText" style='display: none'>Test</p>

</body>

</html>